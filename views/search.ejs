<!DOCTYPE html>
<html lang="en">
<head>
    <%- include("partials/head.ejs") %>
</head>
<body class="container">
<h2>Search Quotes by Keyword</h2>
<form method="POST" action="/search">
  <input name="keyword" placeholder="Enter keyword..." required>
  <button class="btn btn-primary">Search</button>
</form>
<% if (error) { %>
  <div class="alert alert-danger"><%= error %></div>
<% } %>
<% if (results && results.length > 0) { %>
  <table class="table">
    <thead>
      <tr><th>Quote</th><th>Author</th><th>Category</th><th>Likes</th></tr>
    </thead>
    <tbody>
      <% results.forEach(row => { %>
        <tr>
          <td><%= row.quote %></td>
          <td>
            <a href="#" onclick="showAuthorInfo('<%= row.authorId %>'); return false;">
              <%= row.firstName %> <%= row.lastName %>
            </a>
          </td>
          <td><%= row.category %></td>
          <td><%= row.likes %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
<% } %>
<!-- Author info modal -->
<div class="modal" tabindex="-1" id="authorModal" style="display:none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title" id="authorModalTitle"></h5>
      <button type="button" class="btn-close" onclick="closeModal()"></button></div>
      <div class="modal-body" id="authorModalBody"></div>
    </div>
  </div>
</div>
<script>
function showAuthorInfo(authorId) {
  fetch(`/author/${authorId}`)
    .then(res => res.json())
    .then(author => {
      document.getElementById('authorModalTitle').innerText = author.firstName + ' ' + author.lastName;
      document.getElementById('authorModalBody').innerHTML =
        `<img src="${author.pic}" class="img-fluid"/><br>
        <strong>Born:</strong> ${author.dob || ''} <br>
        <strong>Died:</strong> ${author.dod || ''} <br>
        <strong>Biography:</strong> <p>${author.bio}</p>
        <strong>Gender:</strong> ${author.gender || ''}`;
      document.getElementById('authorModal').style.display = 'block';
    });
}
function closeModal() {
  document.getElementById('authorModal').style.display = 'none';
}
</script>
</body>
<footer>
    <%- include("partials/foot.ejs") %>
</footer>
</html>
